---
- name: Coletar dados completos do servidor
  hosts: all
  gather_facts: no
  become: yes

  tasks:

    - name: Verificar vers√£o do Linux
      shell: ". /etc/profile && grep ^PRETTY_NAME= /etc/os-release | cut -d= -f2- | tr -d '\"'"
      register: linux_version
      ignore_errors: yes

    - name: Verificar vers√£o do MariaDB
      shell: ". /etc/profile && mysql -V"
      register: mysql_version
      ignore_errors: yes

    - name: Verificar espa√ßo em disco de todas as parti√ß√µes
      shell: ". /etc/profile && df -h --output=source,fstype,size,used,avail,pcent,target"
      register: disk_usage
      ignore_errors: yes

    - name: Verificar uso de mem√≥ria
      shell: ". /etc/profile && free -g | awk '/Mem:/ {print $2 \" GB\"}'"
      register: mem_usage
      ignore_errors: yes

    - name: Verificar uptime
      shell: ". /etc/profile && uptime -p"
      register: uptime_info
      ignore_errors: yes

    - name: Verificar IP do servidor
      shell: ". /etc/profile && hostname -I | awk '{print $1}'"
      register: ip_info
      ignore_errors: yes

    - name: Verificar usu√°rios conectados
      shell: ". /etc/profile && who | wc -l"
      register: user_count
      ignore_errors: yes

    - name: Exibir dados organizados do servidor
      debug:
        msg: |
          ======= DADOS DO SERVIDOR: {{ inventory_hostname }} =======

          üêß Distribui√ß√£o Linux:{{ linux_version.stdout | default('N√£o encontrado') }}

          üõ¢Ô∏è Vers√£o do MariaDB: {{ mysql_version.stdout | default('N√£o encontrado') }}

          üíΩ Espa√ßo em disco (todas as parti√ß√µes):
          {{ disk_usage.stdout | default('N√£o encontrado') }}

          üß† Mem√≥ria:{{ mem_usage.stdout | default('N√£o encontrado') }}

          ‚è±Ô∏è Uptime:{{ uptime_info.stdout | default('N√£o encontrado') }}

          üåê IP do servidor:{{ ip_info.stdout | default('N√£o encontrado') }}

          üë• Usu√°rios conectados:{{ user_count.stdout | default('N√£o encontrado') }}